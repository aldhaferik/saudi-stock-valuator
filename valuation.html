<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saudi Valuator AI (Debug)</title>
    <style>
        body { font-family: sans-serif; padding: 30px; text-align: center; background-color: #f0f0f0; }
        .container { background: white; padding: 20px; border-radius: 10px; display: inline-block; width: 300px; }
        input { width: 90%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; }
        button { width: 100%; padding: 15px; background: blue; color: white; font-weight: bold; cursor: pointer; }
        .result { margin-top: 20px; text-align: left; padding: 10px; border: 1px solid #ddd; display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>üõ† DIAGNOSTIC MODE</h2>
    
    <label>Access Code:</label>
    <input type="text" id="code" value="KHALED-VIP">
    
    <label>Ticker:</label>
    <input type="text" id="ticker" value="1120">
    
    <button onclick="runDiagnostic()">START TEST</button>

    <div class="result" id="resultArea">
        <h3 id="compName">--</h3>
        <p>Verdict: <b id="verdict">--</b></p>
        <p>Price: <span id="price">--</span></p>
    </div>
</div>

<script>
    async function runDiagnostic() {
        const t = document.getElementById('ticker').value.trim();
        const c = document.getElementById('code').value.trim();
        const area = document.getElementById('resultArea');

        // STEP 1
        alert("STEP 1: Starting... \nTicker: " + t + "\nCode: " + c);

        try {
            const url = `https://saudi-stock-valuator.onrender.com/test?ticker=${t}&code=${c}`;
            
            // STEP 2
            alert("STEP 2: About to connect to:\n" + url);

            const response = await fetch(url);

            // STEP 3
            alert("STEP 3: Connection Status: " + response.status);

            if (response.status !== 200) {
                alert("‚ùå STOPPED! Server said: " + response.status);
                return;
            }

            const data = await response.json();

            // STEP 4
            alert("STEP 4: Data Received!\n" + JSON.stringify(data));

            if (data.valuation_summary) {
                document.getElementById('compName').innerText = data.valuation_summary.company_name;
                document.getElementById('verdict').innerText = data.valuation_summary.verdict;
                document.getElementById('price').innerText = data.valuation_summary.current_price;
                area.style.display = "block";
                
                // STEP 5
                alert("STEP 5: Screen Updated! You should see results now.");
            } else {
                alert("‚ùå ERROR: Data is empty/wrong format.");
            }

        } catch (err) {
            // STEP FAILURE
            alert("‚ùå CRASHED: " + err.message);
        }
    }
</script>

</body>
</html>
