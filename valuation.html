<!DOCTYPE html>
<html>
<head>
    <title>DEBUG MODE</title>
</head>
<body style="background: white; color: black; font-family: monospace; padding: 20px;">

    <h2>üõ† SYSTEM DIAGNOSTIC</h2>
    
    <p>1. Enter Code (e.g. KHALED-VIP):</p>
    <input type="text" id="pass" value="KHALED-VIP" style="border: 2px solid red;">
    
    <p>2. Enter Ticker (e.g. 1120):</p>
    <input type="text" id="tick" value="1120" style="border: 2px solid blue;">
    
    <br><br>
    <button onclick="runTest()" style="padding: 10px 20px; font-size: 20px;">RUN TEST</button>
    
    <hr>
    <h3>STATUS LOG:</h3>
    <div id="log" style="background: #eee; padding: 10px; border: 1px solid #999;">Waiting...</div>

    <h3>RAW SERVER DATA:</h3>
    <pre id="output" style="background: #222; color: #0f0; padding: 10px; min-height: 100px;">...</pre>

    <script>
        function logger(msg) {
            document.getElementById('log').innerHTML += "<br>" + msg;
        }

        async function runTest() {
            const code = document.getElementById('pass').value;
            const ticker = document.getElementById('tick').value;
            const out = document.getElementById('output');
            
            out.innerText = "Loading...";
            logger("üöÄ Starting Request...");

            try {
                // 1. Send Request
                const res = await fetch('https://saudi-stock-valuator.onrender.com/analyze', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ access_code: code, ticker: ticker })
                });

                logger("üì° Server Status: " + res.status);

                if (res.status != 200) {
                    const txt = await res.text();
                    out.innerText = "ERROR " + res.status + ":\n" + txt;
                    return;
                }

                // 2. Read Data
                const data = await res.json();
                logger("‚úÖ Data Received!");
                
                // 3. Show Raw Data
                out.innerText = JSON.stringify(data, null, 2);

            } catch (err) {
                logger("‚ùå NETWORK ERROR: " + err.message);
                out.innerText = "CRASH: " + err.message;
            }
        }
    </script>

</body>
</html>
